
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2016-02-11
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Building | Apache Beam</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href=".//css/bootswatch.css" rel="stylesheet" />
		<link href=".//css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href=".//css/lightbox.css" rel="stylesheet" />

		<link href=".//css/site.css" rel="stylesheet" />
		<link href=".//css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-building-and-deploying project-site" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="./"><img src="http://beam.incubator.apache.org/images/beam-123x43.png" /></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="./" title="Home">Home</a></li>
									<li ><a href="getting-started.html" title="Getting started">Getting started</a></li>
									<li ><a href="guides.html" title="Guides">Guides</a></li>
									<li ><a href="concepts.html" title="Concepts">Concepts</a></li>
									<li ><a href="samples.html" title="Samples">Samples</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Privacy <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="privacy-policy.html" title="Site policy">Site policy</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="mail-lists.html" title="Mailing lists">Mailing lists</a></li>
									<li ><a href="source-repository.html" title="Source">Source</a></li>
									<li ><a href="issue-tracking.html" title="Issues">Issues</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="mail-lists.html" title="Mailing lists">Mailing lists</a></li>
									<li ><a href="team-list.html" title="Team">Team</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
		<div>
			<ul class="breadcrumb">
				<li class="projectVersion version-date">Version: 1.0.0-incubating-SNAPSHOT</li>
				<li class="divider">|</li>
				<li class="publishDate version-date">Last Published: 2016-02-11</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<!-- ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to You under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License. --> 
<div class="page-header">
 <h1 id="building">Building</h1>
</div> 
<p>Simply type at the root of the project:</p> 
<div class="source"> 
 <pre>mvn clean install
</pre> 
</div> 
<p>The Maven build process will generate both a standalone package you can use directly to start the context server (see “Deploying the generated package”) or a KAR file that you can then deploy using a manual deployment process into an already installed Apache Karaf server (see “Deploying into an existing Karaf server”)</p> 
<p>If you want to build and run the integration tests, you should instead use : </p> 
<div class="source"> 
 <pre>mvn -P integration-tests clean install
</pre> 
</div> 
<div class="section"> 
 <h2 id="Deploying_the_generated_package">Deploying the generated package</h2> 
 <p>The “package” sub-project generates a pre-configured Apache Karaf installation that is the simplest way to get started. Simply uncompress the <tt>package/target/unomi-VERSION.tar.gz</tt> (for Linux or Mac OS X) or <tt>package/target/unomi-VERSION.zip</tt> (for Windows) archive into the directory of your choice.</p> 
 <p>You can then start the server simply by using the command on UNIX/Linux/MacOS X : </p> 
 <div class="source"> 
  <pre>./bin/karaf start
</pre> 
 </div> 
 <p>or on Windows shell : </p> 
 <div class="source"> 
  <pre>bin\karaf.bat start
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Deploying_into_an_existing_Karaf_server">Deploying into an existing Karaf server</h2> 
 <p>This is only needed if you didn’t use the generated package. Also, this is the preferred way to install a development environment if you intend to re-deploy the context server KAR iteratively.</p> 
 <p>Additional requirements: - Apache Karaf 3.0.2+, <a class="externalLink" href="http://karaf.apache.org">http://karaf.apache.org</a> - Local copy of the Elasticsearch ZIP package, available here : <a class="externalLink" href="http://www.elasticsearch.org">http://www.elasticsearch.org</a></p> 
 <ol style="list-style-type: decimal"> 
  <li> <p>Before deploying, make sure that you have Apache Karaf properly installed. You will also have to increase the default maximum memory size and perm gen size by adjusting the following environment values in the bin/setenv(.bat) files (at the end of the file):</p> 
   <div class="source"> 
    <pre>   MY_DIRNAME=`dirname $0`
   MY_KARAF_HOME=`cd &quot;$MY_DIRNAME/..&quot;; pwd`
   export KARAF_OPTS=&quot;-Djava.library.path=$MY_KARAF_HOME/lib/sigar&quot;
   export JAVA_MAX_MEM=3G
   export JAVA_MAX_PERM_MEM=384M
</pre> 
   </div></li> 
  <li> <p>You will also need to have the Hyperic Sigar native libraries in your Karaf installation, so in order to this go to the Elasticsearch website (<a class="externalLink" href="http://www.elasticsearch.org">http://www.elasticsearch.org</a>) and download the ZIP package. Decompress it somewhere on your disk and copy all the files from the lib/sigar directory into Karaf’s lib/sigar directory (must be created first) EXCEPT THE SIGAR.JAR file.</p></li> 
  <li> <p>Install the WAR support, CXF into Karaf by doing the following in the Karaf command line:</p> 
   <div class="source"> 
    <pre>   feature:install -v war
   feature:repo-add cxf 2.7.11
   feature:install -v cxf/2.7.11
</pre> 
   </div></li> 
  <li> <p>Create a new $MY_KARAF_HOME/etc/org.apache.cxf.osgi.cfg file and put the following property inside :</p> 
   <div class="source"> 
    <pre>   org.apache.cxf.servlet.context=/cxs
</pre> 
   </div></li> 
  <li> <p>Copy the following KAR to the Karaf deploy directory, as in this example line:</p> 
   <div class="source"> 
    <pre>  cp kar/target/unomi-kar-1.0.0-SNAPSHOT.kar ~/java/deployments/unomi/apache-karaf-3.0.1/deploy/
</pre> 
   </div></li> 
  <li> <p>If all went smoothly, you should be able to access the context script here : <a class="externalLink" href="http://localhost:8181/cxs/cluster">http://localhost:8181/cxs/cluster</a> . You should be able to login with karaf / karaf and see basic server information. If not something went wrong during the install.</p></li> 
 </ol> 
</div> 
<div class="section"> 
 <h2 id="JDK_Selection_on_Mac_OS_X">JDK Selection on Mac OS X</h2> 
 <p>You might need to select the JDK to run the tests in the itests subproject. In order to do so you can list the installed JDKs with the following command : </p> 
 <div class="source"> 
  <pre>/usr/libexec/java_home -V
</pre> 
 </div> 
 <p>which will output something like this : </p> 
 <div class="source"> 
  <pre>Matching Java Virtual Machines (7):
    1.7.0_51, x86_64:   &quot;Java SE 7&quot;   /Library/Java/JavaVirtualMachines/jdk1.7.0_51.jdk/Contents/Home
    1.7.0_45, x86_64:   &quot;Java SE 7&quot;   /Library/Java/JavaVirtualMachines/jdk1.7.0_45.jdk/Contents/Home
    1.7.0_25, x86_64:   &quot;Java SE 7&quot;   /Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home
    1.6.0_65-b14-462, x86_64:   &quot;Java SE 6&quot;   /Library/Java/JavaVirtualMachines/1.6.0_65-b14-462.jdk/Contents/Home
    1.6.0_65-b14-462, i386: &quot;Java SE 6&quot; /Library/Java/JavaVirtualMachines/1.6.0_65-b14-462.jdk/Contents/Home
    1.6.0_65-b14-462, x86_64:   &quot;Java SE 6&quot;   /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home
    1.6.0_65-b14-462, i386: &quot;Java SE 6&quot; /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home
</pre> 
 </div> 
 <p>You can then select the one you want using : </p> 
 <div class="source"> 
  <pre>export JAVA_HOME=`/usr/libexec/java_home -v 1.7.0_51`
</pre> 
 </div> 
 <p>and then check that it was correctly referenced using: </p> 
 <div class="source"> 
  <pre>java -version
</pre> 
 </div> 
 <p>which should give you a result such as this: </p> 
 <div class="source"> 
  <pre>java version &quot;1.7.0_51&quot;
Java(TM) SE Runtime Environment (build 1.7.0_51-b13)
Java HotSpot(TM) 64-Bit Server VM (build 24.51-b03, mixed mode)
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Running_the_integration_tests">Running the integration tests</h2> 
 <p>The integration tests are not executed by default to make build time minimal, but it is recommended to run the integration tests at least once before using the server to make sure that everything is ok in the build. Another way to use these tests is to run them from a continuous integration server such as Jenkins, Apache Gump, Atlassian Bamboo or others. </p> 
 <p>Note : the integration tests require a JDK 7 or more recent !</p> 
 <p>To run the tests simply activate the following profile : </p> 
 <div class="source"> 
  <pre>mvn -P integration-tests clean install
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Running_the_performance_tests">Running the performance tests</h2> 
 <p>Performance tests are based on Gatling. You need to have a running context server or cluster of servers before executing the tests.</p> 
 <p>Test parameteres are editable in the performance-tests/src/test/scala/unomi/Parameters.scala file. baseUrls should contains the URLs of all your cluster nodes</p> 
 <p>Run the test by using the gatling.conf file in performance-tests/src/test/resources :</p> 
 <div class="source"> 
  <pre>    export GATLING_CONF=&lt;path&gt;/performance-tests/src/test/resources
    gatling.sh
</pre> 
 </div> 
 <p>Reports are generated in performance-tests/target/results.</p> 
</div> 
<div class="section"> 
 <h2 id="Testing_with_an_example_page">Testing with an example page</h2> 
 <p>A default test page is provided at the following URL:</p> 
 <div class="source"> 
  <pre>   http://localhost:8181/index.html
</pre> 
 </div> 
 <p>This test page will trigger the loading of the /context.js script, which will try to retrieving the user context or create a new one if it doesn’t exist yet. It also contains an experimental integration with Facebook Login, but it doesn’t yet save the context back to the context server.</p> 
</div> 
<div class="section"> 
 <h2 id="Integrating_onto_a_page">Integrating onto a page</h2> 
 <p>Simply reference the context script in your HTML as in the following example:</p> 
 <div class="source"> 
  <pre>&lt;script type=&quot;text/javascript&quot;&gt;
    (function(){ var u=((&quot;https:&quot; == document.location.protocol) ? &quot;https://localhost:8181/&quot; : &quot;http://localhost:8181/&quot;);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript'; g.defer=true; g.async=true; g.src=u+'context.js';
    s.parentNode.insertBefore(g,s); })();
&lt;/script&gt;
</pre> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#building" title="Building">Building <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Deploying_the_generated_package" title="Deploying the generated package">Deploying the generated package</a>
		<li><a href="#Deploying_into_an_existing_Karaf_server" title="Deploying into an existing Karaf server">Deploying into an existing Karaf server</a>
		<li><a href="#JDK_Selection_on_Mac_OS_X" title="JDK Selection on Mac OS X">JDK Selection on Mac OS X</a>
		<li><a href="#Running_the_integration_tests" title="Running the integration tests">Running the integration tests</a>
		<li><a href="#Running_the_performance_tests" title="Running the performance tests">Running the performance tests</a>
		<li><a href="#Testing_with_an_example_page" title="Testing with an example page">Testing with an example page</a>
		<li><a href="#Integrating_onto_a_page" title="Integrating onto a page">Integrating onto a page</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="./" title="Home">Home</a>
						</li>
						<li >
							<a href="getting-started.html" title="Getting started">Getting started</a>
						</li>
						<li >
							<a href="guides.html" title="Guides">Guides</a>
						</li>
						<li >
							<a href="concepts.html" title="Concepts">Concepts</a>
						</li>
						<li >
							<a href="samples.html" title="Samples">Samples</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Contribute</li>
						<li >
							<a href="mail-lists.html" title="Mailing lists">Mailing lists</a>
						</li>
						<li >
							<a href="source-repository.html" title="Source">Source</a>
						</li>
						<li >
							<a href="issue-tracking.html" title="Issues">Issues</a>
						</li>
						<li class="nav-header">Community</li>
						<li >
							<a href="mail-lists.html" title="Mailing lists">Mailing lists</a>
						</li>
						<li >
							<a href="team-list.html" title="Team">Team</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Privacy</li>
						<li >
							<a href="privacy-policy.html" title="Site policy">Site policy</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>© 2016 Apache Software Foundation</blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2016 <a href="http://www.apache.org">Apache Software Foundation</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src=".//js/lightbox.min.js"></script>
	<script src=".//js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src=".//js/reflow-skin.js"></script>

	</body>
</html>
