
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2016-02-11
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Apache Beam | Cluster setup</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cosmo/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href=".//css/bootswatch.css" rel="stylesheet" />
		<link href=".//css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href=".//css/lightbox.css" rel="stylesheet" />

		<link href=".//css/site.css" rel="stylesheet" />
		<link href=".//css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



		<!-- Google Analytics -->
		<script type="text/javascript">

			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-73650088-1']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();

		</script>
		</head>

	<body class="page-clustering project-site" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="./"><span>Apache Beam (incubating)</span></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="./" title="About">About</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="getting-started.html" title="Getting started">Getting started</a></li>
									<li ><a href="https://goo.gl/ps8twC" title="Apache Beam technical docs" class="externalLink">Apache Beam technical docs</a></li>
									<li ><a href="https://goo.gl/nk5OM0" title="Technical vision" class="externalLink">Technical vision</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Privacy <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="privacy-policy.html" title="Site policy">Site policy</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="mail-lists.html" title="Mailing lists">Mailing lists</a></li>
									<li ><a href="source-repository.html" title="Source">Source</a></li>
									<li ><a href="issue-tracking.html" title="Issues">Issues</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="mail-lists.html" title="Mailing lists">Mailing lists</a></li>
									<li ><a href="team-list.html" title="Team">Team</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar" data-spy="affix" data-offset-top="250">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#toc-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<div class="nav-collapse collapse" id="toc-nav-collapse">
						<ul id="toc" class="nav">
						<li class="toplevel"><a href="#cluster_setup" title="Cluster setup">Cluster setup</a></li>
						<li class="dropdown">
							<a href="#Recommended_configurations" title="Recommended configurations" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Recommended configurations <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Recommended_configurations" title="Recommended configurations">Recommended configurations</a></li>
								<li class="divider"></li>
								<li><a href="#a2_nodes_configuration" title="2 nodes configuration">2 nodes configuration</a></li>
								<li><a href="#a3_nodes_configuration" title="3 nodes configuration">3 nodes configuration</a></li>

							</ul>
						</li>
						<li class="toplevel"><a href="#Specific_configuration" title="Specific configuration">Specific configuration</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<!-- ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to You under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License. --> 
<div class="page-header">
 <h1 id="cluster_setup">Cluster setup</h1>
</div> 
<p>Context server relies on Elasticsearch to discover and configure its cluster. You just need to install multiple context servers on the same network, and enable the discovery protocol in $MY_KARAF_HOME/etc/org.apache.unomi.persistence.elasticsearch.cfg file :</p> 
<div class="source"> 
 <pre>discovery.zen.ping.multicast.enabled=true
</pre> 
</div> 
<p>All nodes on the same network, sharing the same cluster name will be part of the same cluster.</p> 
<div class="section"> 
 <div class="section"> 
  <h3 id="Recommended_configurations">Recommended configurations</h3> 
  <p>It is recommended to have one node dedicated to the context server, where the other nodes take care of the Elasticsearch persistence. The node dedicated to the context server will have node.data set to false.</p> 
  <div class="section"> 
   <h4 id="a2_nodes_configuration">2 nodes configuration</h4> 
   <p>One node dedicated to context server, 1 node for elasticsearch storage.</p> 
   <p>Node A :</p> 
   <div class="source"> 
    <pre>node.data=true
numberOfReplicas=0
monthlyIndex.numberOfReplicas=0
</pre> 
   </div> 
   <p>Node B :</p> 
   <div class="source"> 
    <pre>node.data=false
numberOfReplicas=0
monthlyIndex.numberOfReplicas=0
</pre> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="a3_nodes_configuration">3 nodes configuration</h4> 
   <p>One node dedicated to context server, 2 nodes for elasticsearch storage with fault-tolerance</p> 
   <p>Node A :</p> 
   <div class="source"> 
    <pre>node.data=false
numberOfReplicas=1
monthlyIndex.numberOfReplicas=1
</pre> 
   </div> 
   <p>Node B :</p> 
   <div class="source"> 
    <pre>node.data=true
numberOfReplicas=1
monthlyIndex.numberOfReplicas=1
</pre> 
   </div> 
   <p>Node C :</p> 
   <div class="source"> 
    <pre>node.data=true
numberOfReplicas=1
monthlyIndex.numberOfReplicas=1
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Specific_configuration">Specific configuration</h3> 
  <p>If multicast is not allowed on your network, you’ll need to switch to unicast protocol and manually configure the server IPs. This can be done by disabling the elasticsearch automatic discovery in $MY_KARAF_HOME/etc/org.apache.unomi.persistence.elasticsearch.cfg :</p> 
  <div class="source"> 
   <pre>discovery.zen.ping.multicast.enabled=false
</pre> 
  </div> 
  <p>And then set the property discovery.zen.ping.unicast.hosts in $MY_KARAF_HOME/etc/elasticsearch.yml files :</p> 
  <div class="source"> 
   <pre>discovery.zen.ping.unicast.hosts: [‘192.168.0.1:9300', ‘192.168.0.2:9300']
</pre> 
  </div> 
  <p>More information and configuration options can be found at : <a class="externalLink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html</a></p> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="getting-started.html" title="Getting started">Getting started</a>
						</li>
						<li >
							<a href="https://goo.gl/ps8twC" title="Apache Beam technical docs" class="externalLink">Apache Beam technical docs</a>
						</li>
						<li >
							<a href="https://goo.gl/nk5OM0" title="Technical vision" class="externalLink">Technical vision</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Contribute</li>
						<li >
							<a href="mail-lists.html" title="Mailing lists">Mailing lists</a>
						</li>
						<li >
							<a href="source-repository.html" title="Source">Source</a>
						</li>
						<li >
							<a href="issue-tracking.html" title="Issues">Issues</a>
						</li>
						<li class="nav-header">Community</li>
						<li >
							<a href="mail-lists.html" title="Mailing lists">Mailing lists</a>
						</li>
						<li >
							<a href="team-list.html" title="Team">Team</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Privacy</li>
						<li >
							<a href="privacy-policy.html" title="Site policy">Site policy</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>© 2016 Apache Software Foundation</blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2016 <a href="http://www.apache.org">Apache Software Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.0.0-incubating-SNAPSHOT. </span><span class="publishDate">Last Published: 2016-02-11. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src=".//js/lightbox.min.js"></script>
	<script src=".//js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src=".//js/reflow-skin.js"></script>

	</body>
</html>
